<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zxk175.well.module.dao.sys.SysUserDao">

    <select id="listSysUser" resultType="java.util.Map"
            parameterType="com.zxk175.well.common.model.param.sys.user.SysUserListParam">
        SELECT
            su.user_id AS userId,
            su.user_name AS userName,
            su.avatar,
            su.mobile,
            su.identity,
            su.create_time AS createTime,
            su.state,
            IFNULL((SELECT GROUP_CONCAT(sr.role_name) FROM t_sys_user_role AS sur, t_sys_role AS sr WHERE sur.role_id = sr.role_id AND sur.user_id = su.user_id), '') AS roleName
        FROM
            t_sys_user AS su
        WHERE
            1 = 1
        <if test="userId != null and userId != ''">
            AND su.user_id = #{userId}
        </if>
        <if test="mobile != null and mobile != ''">
            AND su.mobile = #{mobile}
        </if>
        LIMIT #{page}, #{size}
    </select>

    <select id="countSysUser" resultType="java.lang.Long"
            parameterType="com.zxk175.well.common.model.param.sys.user.SysUserListParam">
        SELECT
            COUNT(su.user_id) AS `count`
        FROM
            t_sys_user AS su
        WHERE
            1 = 1
        <if test="userId != null and userId != ''">
            AND su.user_id = #{userId}
        </if>
        <if test="mobile != null and mobile != ''">
            AND su.mobile = #{mobile}
        </if>
    </select>

    <select id="listUserPerms" resultType="java.lang.String"
            parameterType="com.zxk175.well.common.model.param.sys.user.SysUserPermsParam">
        SELECT
            m.perms
        FROM
            t_sys_user_role ur
            LEFT JOIN t_sys_role_menu rm ON ur.role_id = rm.role_id
            LEFT JOIN t_sys_menu m ON rm.menu_id = m.menu_id
        WHERE
            m.type = #{menuType}
            AND ur.user_id = #{userId}
    </select>
</mapper>
